<button mat-icon-button [matMenuTriggerFor]="notifMenu" class="bell-btn" title="Notifications">
  <mat-icon
    [matBadge]="notificationService.unreadCount()"
    [matBadgeHidden]="notificationService.unreadCount() === 0"
    matBadgeColor="warn"
    aria-hidden="false"
  >
    notifications
  </mat-icon>
</button>

<mat-menu #notifMenu="matMenu" class="notification-menu">
  <div class="notification-header" (click)="$event.stopPropagation()">
    <h3>Notifications</h3>
    @if (notificationService.unreadCount() > 0) {
      <button mat-button color="primary" (click)="notificationService.markAllAsRead()">
        Mark all read
      </button>
    }
  </div>

  <div class="notification-list" (click)="$event.stopPropagation()">
    @for (notif of notificationService.notifications(); track notif.id) {
      <div
        class="notification-item"
        [class.unread]="!notif.is_read"
        (click)="onNotificationClick(notif)"
      >
        <div class="notif-icon-box" [class]="notif.type">
          <mat-icon>{{ getNotificationIcon(notif.type) }}</mat-icon>
        </div>
        <div class="notif-body">
          <p class="notif-text">{{ notif.content }}</p>
          <span class="notif-time">{{ notif.created_at + 'Z' | date: 'short' }}</span>
        </div>
        @if (!notif.is_read) {
          <div class="unread-status"></div>
        }
      </div>
    } @empty {
      <div class="empty-notifs">
        <mat-icon>notifications_paused</mat-icon>
        <p>No notifications yet</p>
      </div>
    }
  </div>

  <div class="notification-footer" (click)="$event.stopPropagation()">
    @if (notificationService.notifications().length > 0) {
      <button mat-button class="clear-btn" (click)="notificationService.clearAll()">
        Clear All History
      </button>
    } @else {
      <span>Stay alerts, Brawler!</span>
    }
  </div>
</mat-menu>
