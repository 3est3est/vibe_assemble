<div class="mission-manager-container">
  <div class="tech-grid"></div>

  <div class="page-layout">
    <!-- SIDEBAR -->
    <aside class="page-sidebar">
      <div class="flex flex-col gap-1 mb-10">
        <div class="os-nav-item active">
          <i class="pi pi-th-large"></i>
          <span>My Rooms</span>
        </div>
        <div class="os-nav-item" (click)="onCreate()">
          <i class="pi pi-plus-circle"></i>
          <span>Create New Room</span>
        </div>
      </div>

      <div class="mt-auto pt-8 border-t border-white/5">
        <div class="sidebar-stat">
          <span class="label">Hosting Capacity</span>
          <div class="flex items-baseline gap-2 mt-4">
            <span class="text-4xl font-black text-white italic tracking-tighter">{{
              myMissions().length
            }}</span>
            <span class="text-[9px] font-black text-white/20 uppercase tracking-[0.2em]"
              >Active Rooms</span
            >
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <section class="page-main relative z-10">
      <div class="page-header flex justify-between items-end mb-12">
        <div class="flex flex-col">
          <div class="flex items-center gap-3 mb-2">
            <div class="w-2 h-2 rounded-full bg-accent shadow-[0_0_10px_var(--accent-glow)]"></div>
            <span class="text-[10px] font-black text-accent uppercase tracking-[0.3em]"
              >Hosting System: Online</span
            >
          </div>
          <h1 class="page-title leading-none">Room Manager</h1>
          <p class="text-[12px] text-white/30 font-bold uppercase tracking-widest mt-2">
            Configure and manage your created hangout rooms
          </p>
        </div>

        <button (click)="onCreate()" class="btn btn-primary btn-sm !px-8 !rounded-xl">
          <i class="pi pi-plus mr-2"></i> CREATE ROOM
        </button>
      </div>

      <div class="missions-grid stagger">
        @for (mission of myMissions(); track mission.id; let i = $index) {
          <div class="mission-card-os group" [routerLink]="['/missions', mission.id]">
            <div class="card-cover-wrap">
              <img
                [src]="getVibeImage(mission.category)"
                class="card-cover"
                [alt]="mission.name"
                loading="lazy"
              />

              <div class="card-category-pill">
                <span
                  class="status-tag"
                  [ngClass]="'status-' + (mission.status.toLowerCase().replace(' ', '-') || 'open')"
                >
                  {{ mission.status }}
                </span>
              </div>

              <!-- Management Overlay Actions -->
              <div
                class="absolute top-4 right-4 z-20 flex gap-2 opacity-0 group-hover:opacity-100 transition-all transform translate-y-2 group-hover:translate-y-0"
              >
                <button
                  (click)="onEdit(mission); $event.stopPropagation()"
                  class="w-10 h-10 rounded-xl bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white hover:text-black flex items-center justify-center text-white transition-all shadow-xl"
                  title="Modify Room"
                >
                  <i class="pi pi-pencil text-xs"></i>
                </button>
                <button
                  (click)="onDelete(mission); $event.stopPropagation()"
                  class="w-10 h-10 rounded-xl bg-red-500/10 backdrop-blur-md border border-red-500/20 hover:bg-red-500 hover:text-white flex items-center justify-center text-red-500 transition-all shadow-xl"
                  title="Terminate Room"
                >
                  <i class="pi pi-trash text-xs"></i>
                </button>
              </div>
            </div>

            <div class="card-body">
              <span class="badge mb-2" [ngClass]="getCategoryClass(mission.category)">{{
                mission.category || 'Vibe Room'
              }}</span>
              <h2 class="card-title">{{ mission.name }}</h2>

              <!-- NEW: Location & Time -->
              <div class="flex items-center gap-3 text-xs text-white/60 mt-1 mb-2">
                @if (mission.location) {
                  <div class="flex items-center gap-1">
                    <i class="pi pi-map-marker text-accent text-[10px]"></i>
                    <span class="truncate max-w-[100px]">{{ mission.location }}</span>
                  </div>
                }
                @if (mission.scheduled_at) {
                  <div class="flex items-center gap-1">
                    <i class="pi pi-calendar text-accent text-[10px]"></i>
                    <span>{{ mission.scheduled_at | date: 'shortTime' }}</span>
                  </div>
                }
              </div>

              <p class="card-desc">
                {{
                  mission.description ||
                    'Welcome to the mission room. Join our crew and start the activity.'
                }}
              </p>
            </div>

            <div class="card-footer">
              <div class="card-host">
                <img
                  [src]="
                    mission.chief_avatar_url ||
                    'https://api.dicebear.com/7.x/bottts-neutral/svg?seed=' +
                      mission.chief_display_name
                  "
                  class="w-7 h-7 rounded-lg object-cover"
                />
                <span class="font-bold text-white/40 uppercase tracking-widest text-[9px]"
                  >YOUR ROOM</span
                >
              </div>
              <div class="card-stats">
                {{ mission.crew_count }}/{{ mission.max_crew }} <i class="pi pi-users"></i>
              </div>
            </div>
          </div>
        } @empty {
          <div
            class="col-span-full py-48 flex flex-col items-center justify-center gap-8 opacity-20"
          >
            <div
              class="w-24 h-24 rounded-3xl bg-white/5 flex items-center justify-center ring-1 ring-white/10"
            >
              <i class="pi pi-bolt text-4xl"></i>
            </div>
            <div class="text-center max-w-sm">
              <h3 class="font-black uppercase tracking-[0.4em] text-xs text-white mb-3">
                No Rooms Created
              </h3>
              <p
                class="text-[11px] text-white/60 font-medium leading-relaxed uppercase tracking-widest"
              >
                Your activity list is empty. Create a new room to start building your community.
              </p>
              <button
                class="mt-8 text-accent text-[11px] font-black uppercase tracking-[0.3em] hover:tracking-[0.4em] transition-all"
                (click)="onCreate()"
              >
                // CREATE_YOUR_FIRST_ROOM
              </button>
            </div>
          </div>
        }
      </div>
    </section>
  </div>
</div>
