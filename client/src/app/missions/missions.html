<div class="missions-container">
  <div class="godly-hero-missions">
    <div class="page-layout">
      <!-- SIDEBAR -->
      <aside class="page-sidebar">
        <div class="flex flex-col gap-1">
          <div
            class="os-nav-item"
            [class.active]="!selectedCategory"
            (click)="selectedCategory = ''; filterMissions()"
          >
            <i class="pi pi-compass"></i>
            <span>Browse All</span>
          </div>
          <div class="os-nav-item">
            <i class="pi pi-calendar"></i>
            <span>My Schedule</span>
          </div>
        </div>

        <div class="flex flex-col gap-4">
          <span class="label">Categories</span>
          <div class="grid grid-cols-1 gap-1">
            @for (cat of categories; track cat.name) {
              <div
                class="os-nav-item"
                [class.active]="selectedCategory === cat.name"
                (click)="selectedCategory = cat.name; filterMissions()"
              >
                <span class="text-lg mr-2">{{ cat.emoji }}</span>
                <span>{{ cat.name }}</span>
              </div>
            }
          </div>
        </div>

        <div class="mt-auto pt-4 border-t border-white/5">
          <div class="flex items-center gap-3 px-3">
            <div
              class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"
            ></div>
            <span class="text-[10px] font-bold text-white uppercase tracking-wider">Live Now</span>
          </div>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <section class="page-main">
        <div class="page-header">
          <h1 class="page-title">Discover Activities</h1>
          <div class="search-wrap">
            <i class="pi pi-search"></i>
            <input
              type="text"
              placeholder="Find a activity room..."
              [(ngModel)]="searchTerm"
              (input)="filterMissions()"
            />
          </div>
        </div>

        <div class="missions-grid hide-scrollbar overflow-y-auto">
          @for (mission of filteredMissions; track mission.id; let i = $index) {
            <div class="mission-card-os group" [routerLink]="['/missions', mission.id]">
              <!-- Card Cover Image with Dynamic Backgrounds -->
              <div class="card-cover-wrap">
                <!-- Thematic Images based on Category -->
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Gaming & E-Sports'"
                />
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Sports & Active'"
                />
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1514525253361-9f9a5690d562?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Entertainment'"
                />
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1493225255756-d9584f8606e9?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Social & Chill'"
                />
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1500835595546-64e86b468cc0?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Travel & Trip'"
                />
                <img
                  [src]="
                    'https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&q=80&w=600'
                  "
                  class="card-cover"
                  *ngIf="mission.category === 'Lifestyle & Hobby'"
                />
                <!-- Default Gradient if no image -->
                <div
                  class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"
                ></div>
                <div class="absolute top-4 left-4">
                  <span
                    class="status-tag"
                    [ngClass]="
                      'status-' + (mission.status.toLowerCase().replace(' ', '-') || 'open')
                    "
                  >
                    {{ mission.status }}
                  </span>
                </div>
              </div>

              <div class="card-body">
                <div class="flex flex-col gap-1">
                  <span class="text-[10px] font-black text-accent uppercase tracking-widest">{{
                    mission.category || 'Vibe Room'
                  }}</span>
                  <h2 class="room-title">{{ mission.name }}</h2>
                </div>

                <p class="text-[13px] text-white/50 line-clamp-2 leading-relaxed h-[40px]">
                  {{
                    mission.description ||
                      'Join us for a great ' +
                        mission.category +
                        ' session. Connect and share your vibe!'
                  }}
                </p>

                <div class="room-metadata">
                  <div class="meta-item">
                    <i class="pi pi-map-marker"></i>
                    <span class="truncate max-w-[120px]">{{
                      mission.location || 'Online Session'
                    }}</span>
                  </div>
                  <div class="meta-item ml-auto">
                    <i class="pi pi-calendar"></i>
                    <span>Today</span>
                  </div>
                </div>
              </div>

              <div class="card-footer">
                <div class="flex items-center gap-3">
                  <img
                    [src]="
                      'https://ui-avatars.com/api/?name=' +
                      mission.chief_display_name +
                      '&background=random&color=fff'
                    "
                    class="w-8 h-8 rounded-full border border-white/10"
                  />
                  <div class="flex flex-col">
                    <span class="text-[11px] font-bold text-white">{{
                      mission.chief_display_name
                    }}</span>
                    <div class="flex items-center gap-1">
                      <i class="pi pi-users text-[9px] text-white/40"></i>
                      <span class="text-[10px] text-white/40 font-bold"
                        >{{ mission.crew_count }} / {{ mission.max_crew }}</span
                      >
                    </div>
                  </div>
                </div>

                <div class="card-footer-action">
                  <button class="btn btn-primary btn-sm rounded-xl px-5 shadow-xl font-bold">
                    Enter Room
                  </button>
                </div>
              </div>
            </div>
          } @empty {
            <div class="col-span-full py-60 flex flex-col items-center justify-center opacity-20">
              <i class="pi pi-search text-6xl mb-6"></i>
              <p class="font-bold uppercase tracking-widest text-sm">No activity vibe found</p>
            </div>
          }
        </div>
      </section>
    </div>
  </div>
</div>
