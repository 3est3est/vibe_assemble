<header class="page-header">
  <h1>Discovery</h1>
  <p>Find and join open missions across the galaxy.</p>
</header>

<div class="discovery-controls">
  <div class="search-input">
    <mat-icon>search</mat-icon>
    <input
      type="text"
      [(ngModel)]="filter.name"
      placeholder="Search by mission name..."
      (keyup.enter)="onSubmit()"
    />
  </div>

  <select class="status-select" [(ngModel)]="filter.status">
    <option value="">All Statuses</option>
    <option value="Open">Open</option>
    <option value="InProgress">In Progress</option>
    <option value="Completed">Completed</option>
    <option value="Failed">Failed</option>
  </select>

  <button class="filter-btn" (click)="onSubmit()">Filter</button>
</div>

<div class="data-table">
  @if ((missions$ | async)?.length) {
    <div class="table-header">
      <span>Mission</span>
      <span>Description</span>
      <span>Chief</span>
      <span>Status</span>
      <span>Crew</span>
      <span></span>
    </div>

    @for (mission of missions$ | async; track mission.id) {
      <div class="table-row">
        <div class="mission-info">
          <span class="name">{{ mission.name }}</span>
          <div class="meta">
            @if (mission.scheduled_at) {
              <span
                ><mat-icon>schedule</mat-icon>
                {{ mission.scheduled_at | date: 'MMM d, h:mm a' }}</span
              >
            }
            @if (mission.location) {
              <span><mat-icon>place</mat-icon> {{ mission.location }}</span>
            }
          </div>
        </div>

        <div class="description" [title]="mission.description">{{ mission.description }}</div>

        <div class="chief">
          <div class="chief-circle">{{ mission.chief_display_name[0] | uppercase }}</div>
          <span>{{ mission.chief_display_name }}</span>
        </div>

        <div>
          <span [class]="'status-badge ' + mission.status.toLowerCase()">{{ mission.status }}</span>
        </div>

        <div class="crew-count">{{ mission.crew_count }} / {{ mission.max_crew }}</div>

        <div class="action-cell">
          @if (isSignin()) {
            @if (mission.status === 'Open') {
              <button
                class="action-btn"
                (click)="onJoin(mission)"
                [disabled]="mission.crew_count >= mission.max_crew"
              >
                {{ mission.crew_count >= mission.max_crew ? 'Full' : 'Join' }}
              </button>
            } @else {
              <span class="status-badge">Locked</span>
            }
          }
        </div>
      </div>
    }
  } @else {
    <div class="empty-state">
      <mat-icon>rocket</mat-icon>
      <p>No missions found matching your criteria.</p>
    </div>
  }
</div>
