<div class="network-container">
  <div class="bg-mesh"></div>

  <div class="godly-hero-network">
    <!-- NETWORK OS WINDOW -->
    <main class="os-window-base os-network-window">
      <!-- GROUPS SIDEBAR -->
      <aside class="os-sidebar-base os-network-sidebar">
        <div class="os-dot-controls mb-8"><span></span><span></span><span></span></div>

        <div class="flex flex-col gap-1 mb-10">
          <div
            class="os-network-nav-item"
            [class.active]="activeTab === 'all'"
            (click)="activeTab = 'all'"
          >
            <span>All Contacts</span>
            <span class="text-[8px] opacity-40">{{ friends().length }}</span>
          </div>
          <div
            class="os-network-nav-item"
            [class.active]="activeTab === 'online'"
            (click)="activeTab = 'online'"
          >
            <span>Direct Channels</span>
            <span class="text-[8px] opacity-40">{{ onlineUsers().length }}</span>
          </div>
          <div
            class="os-network-nav-item"
            [class.active]="activeTab === 'requests'"
            (click)="activeTab = 'requests'"
          >
            <span>Clearances</span>
            @if (pendingRequests().length > 0) {
              <div class="w-1.5 h-1.5 rounded-full bg-white shadow-[0_0_8px_white]"></div>
            }
          </div>
        </div>

        <div class="mt-auto pt-8 border-t border-white/5">
          <span class="os-label">Sector_Monitor</span>
          <div class="flex items-center gap-3">
            <div class="presence-dot-os"></div>
            <span class="text-[9px] font-black text-white uppercase tracking-widest"
              >Active Scanning</span
            >
          </div>
        </div>
      </aside>

      <!-- NETWORK MAIN CONTENT -->
      <section class="os-main-base os-network-main">
        <div class="os-title-bar mb-10">
          <div class="flex flex-col py-4">
            <span class="os-label">Network_Directory</span>
            <h1 class="os-title-large">Social <span class="opacity-30 italic">Grid</span></h1>
          </div>
        </div>

        @if (activeTab === 'all' || activeTab === 'online') {
          <div class="agent-grid overflow-y-auto hide-scrollbar pb-20">
            @for (user of activeTab === 'all' ? friends() : onlineUsers(); track user.id) {
              <div class="os-glass-card contact-card-os group">
                <div class="contact-avatar">
                  <img
                    [src]="
                      user.avatar_url || 'https://ui-avatars.com/api/?name=' + user.display_name
                    "
                    class="w-full h-full object-cover rounded-2xl"
                  />
                  @if (user.is_online || activeTab === 'online') {
                    <div class="presence-dot-network"></div>
                  }
                </div>

                <h3 class="text-xs font-black text-white uppercase tracking-widest mb-1">
                  {{ user.display_name }}
                </h3>
                <span class="text-[8px] font-black text-zinc-600 uppercase tracking-widest mb-12">{{
                  user.rank || 'Junior Operative'
                }}</span>

                <div class="actions-overlay">
                  <button (click)="openChat(user)" class="os-action-btn-sm">
                    <i class="pi pi-comments text-[10px]"></i>
                  </button>
                  <button [routerLink]="['/profile', user.id]" class="os-action-btn-sm">
                    <i class="pi pi-user text-[10px]"></i>
                  </button>
                  @if (activeTab === 'all') {
                    <button (click)="onRemoveFriend(user)" class="os-action-btn-sm danger">
                      <i class="pi pi-user-minus text-[10px]"></i>
                    </button>
                  }
                </div>
              </div>
            } @empty {
              <div class="col-span-full py-40 flex flex-col items-center justify-center opacity-10">
                <i class="pi pi-users text-6xl mb-8"></i>
                <p class="text-xs font-black uppercase tracking-[0.5em]">
                  No signal patterns detected
                </p>
              </div>
            }
          </div>
        }

        @if (activeTab === 'requests') {
          <div class="overflow-y-auto hide-scrollbar pb-20">
            @for (req of pendingRequests(); track req.id) {
              <div class="os-glass-card clearance-item-os group">
                <img
                  [src]="
                    req.requester_avatar || 'https://ui-avatars.com/api/?name=' + req.requester_name
                  "
                  class="w-14 h-14 rounded-xl object-cover border border-white/10"
                />
                <div class="flex-grow">
                  <span
                    class="text-xs font-black text-white uppercase tracking-widest mb-1 block"
                    >{{ req.requester_name }}</span
                  >
                  <span class="text-[8px] font-black text-zinc-600 uppercase tracking-widest"
                    >Inbound Signal Request</span
                  >
                </div>
                <div class="flex gap-3">
                  <button
                    (click)="onAccept(req.id)"
                    class="px-6 h-10 rounded-xl bg-white text-black text-[9px] font-black uppercase tracking-widest hover:bg-zinc-200 transition-colors"
                  >
                    Authorize
                  </button>
                  <button
                    (click)="onReject(req.id)"
                    class="px-6 h-10 rounded-xl bg-white/[0.03] border border-white/5 text-zinc-600 text-[9px] font-black uppercase tracking-widest hover:text-red-500 transition-colors"
                  >
                    Decline
                  </button>
                </div>
              </div>
            } @empty {
              <div class="py-40 flex flex-col items-center justify-center opacity-10">
                <i class="pi pi-verified text-6xl mb-8"></i>
                <p class="text-xs font-black uppercase tracking-[0.5em]">Network Clear</p>
              </div>
            }
          </div>
        }
      </section>
    </main>
  </div>
</div>
