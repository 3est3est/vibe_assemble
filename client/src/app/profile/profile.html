<div class="profile-container">
  <div class="identity-column">
    <div class="identity-card">
      <div class="avatar-wrapper">
        <img [src]="avatar_url()" alt="avatar" class="avatar-lg" />
        <button *ngIf="isOwnProfile()" class="edit-avatar-btn" (click)="openAvatarDialog()">
          <mat-icon>photo_camera</mat-icon>
        </button>
      </div>

      <h1 class="display-name">{{ display_name() }}</h1>

      <div class="rank-badge" [class]="rank().toLowerCase()">{{ rank() }}</div>

      <!-- Friendship Actions -->
      <div class="friend-actions" *ngIf="!isOwnProfile()">
        <button
          *ngIf="!friendshipStatus()"
          mat-flat-button
          color="primary"
          class="friend-btn"
          (click)="addFriend()"
        >
          <mat-icon>person_add</mat-icon>
          Add Friend
        </button>

        <button
          *ngIf="friendshipStatus() === 'pending'"
          mat-stroked-button
          disabled
          class="friend-btn pending"
        >
          <mat-icon>hourglass_empty</mat-icon>
          Pending
        </button>

        @if (friendshipStatus() === 'accepted') {
          <button mat-flat-button class="friend-btn accepted" [matMenuTriggerFor]="friendMenu">
            <mat-icon>check</mat-icon>
            Friends
          </button>
          <mat-menu #friendMenu="matMenu">
            <button mat-menu-item (click)="unfriend()">
              <mat-icon>person_remove</mat-icon>
              Unfriend
            </button>
          </mat-menu>
        }

        <button mat-stroked-button class="friend-btn message" (click)="openChat()">
          <mat-icon>chat</mat-icon>
          Message
        </button>
      </div>

      <button
        *ngIf="isOwnProfile()"
        mat-stroked-button
        class="edit-btn"
        (click)="openEditProfileDialog()"
      >
        <mat-icon>edit</mat-icon>
        Edit Profile
      </button>

      @if (bio()) {
        <p class="bio-text">"{{ bio() }}"</p>
      }

      <div class="contacts-box">
        @if (instagram()) {
          <div class="contact-item ig">
            <img src="/assets/icons/instagram.jpg" alt="Instagram" class="contact-icon" />
            <span>{{ instagram() }}</span>
          </div>
        }
        @if (facebook()) {
          <div class="contact-item fb">
            <img src="/assets/icons/facebook.png" alt="Facebook" class="contact-icon" />
            <span>{{ facebook() }}</span>
          </div>
        }
        @if (discord_id()) {
          <div class="contact-item discord">
            <img src="/assets/icons/discord.jpg" alt="Discord" class="contact-icon" />
            <span>{{ discord_id() }}</span>
          </div>
        }
        @if (contact_email()) {
          <div class="contact-item email">
            <mat-icon>alternate_email</mat-icon>
            <span>{{ contact_email() }}</span>
          </div>
        }
      </div>
    </div>
  </div>

  <div class="stats-column">
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">{{ stats().hosted }}</div>
        <div class="stat-label">Hosted Events</div>
      </div>
      <div class="stat-item">
        <div class="stat-value highlight">{{ stats().joined }}</div>
        <div class="stat-label">Joined Events</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ stats().active }}</div>
        <div class="stat-label">Active Now</div>
      </div>
    </div>

    <div class="recent-activity-card">
      <h3>Recent Activities</h3>
      @if (missions().length > 0) {
        <div class="mission-list">
          @for (mission of missions().slice(0, 5); track mission.id) {
            <div class="mission-row">
              <div class="status-dot" [class]="mission.status.toLowerCase()"></div>
              <span class="mission-name">{{ mission.name }}</span>
              <span class="mission-date">{{ mission.created_at | date: 'MMM d, y' }}</span>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">No activities recorded yet.</div>
      }
    </div>
  </div>
</div>
